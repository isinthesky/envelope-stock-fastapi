# CLAUDE.md - src ë””ë ‰í† ë¦¬ ê°€ì´ë“œ

> **ì†ŒìŠ¤ ì½”ë“œ ë£¨íŠ¸**: FastAPI ì„œë²„ì˜ ëª¨ë“  ì†ŒìŠ¤ ì½”ë“œê°€ ìœ„ì¹˜í•˜ëŠ” í•µì‹¬ ë””ë ‰í† ë¦¬

## ğŸ“ ë””ë ‰í† ë¦¬ ì—­í• 

`src/` ë””ë ‰í† ë¦¬ëŠ” **í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜(Ports & Adapters)** ê¸°ë°˜ì˜ FastAPI ì„œë²„ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ê° í•˜ìœ„ ë””ë ‰í† ë¦¬ëŠ” ëª…í™•í•œ ì±…ì„ê³¼ ì—­í• ì„ ê°€ì§‘ë‹ˆë‹¤.

---

## ğŸ“‚ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/
â”œâ”€â”€ main.py                 # ASGI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”œâ”€â”€ __init__.py
â”‚
â”œâ”€â”€ settings/               # âš™ï¸ í™˜ê²½ ì„¤ì • ê³„ì¸µ
â”‚   â”œâ”€â”€ config.py           # Pydantic Settings ê¸°ë°˜ ì„¤ì •
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ adapters/               # ğŸ”Œ ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ ê³„ì¸µ (Infrastructure)
â”‚   â”œâ”€â”€ database/           # PostgreSQL + SQLAlchemy
â”‚   â”œâ”€â”€ cache/              # Redis ìºì‹œ
â”‚   â””â”€â”€ external/           # KIS API, WebSocket í´ë¼ì´ì–¸íŠ¸
â”‚
â””â”€â”€ application/            # ğŸ’¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ
    â”œâ”€â”€ interface/          # API Router (Presentation)
    â”œâ”€â”€ domain/             # ë„ë©”ì¸ ì„œë¹„ìŠ¤ (Business Logic)
    â””â”€â”€ common/             # ê³µí†µ ìœ í‹¸ë¦¬í‹°
```

---

## ğŸ›ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

### í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ ë ˆì´ì–´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Interface Layer                             â”‚
â”‚              (application/interface/*_router.py)                 â”‚
â”‚                   FastAPI Router, Request/Response               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Domain Layer                                â”‚
â”‚                (application/domain/*/service.py)                 â”‚
â”‚               ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë„ë©”ì¸ ê·œì¹™, DTO                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Common Layer                                â”‚
â”‚                   (application/common/*)                         â”‚
â”‚          Decorators, Validators, Dependencies, DTO               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Adapter Layer                                â”‚
â”‚                      (adapters/*)                                â”‚
â”‚         Database, Cache, External API ì—°ë™                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Settings Layer                                â”‚
â”‚                     (settings/*)                                 â”‚
â”‚               í™˜ê²½ ì„¤ì •, ìƒìˆ˜, ì‹œí¬ë¦¿ ê´€ë¦¬                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ í•µì‹¬ íŒŒì¼ ì„¤ëª…

### main.py
```python
# ASGI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
# - FastAPI ì•± ì´ˆê¸°í™”
# - Router ë“±ë¡
# - Middleware ì„¤ì •
# - Lifespan ì´ë²¤íŠ¸ (startup/shutdown)
```

### settings/config.py
- `Settings` í´ë˜ìŠ¤: Pydantic Settings ê¸°ë°˜ í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
- `get_settings()`: ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ ì„¤ì • ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜
- KIS API, Database, Redis, ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì„¤ì • í¬í•¨

---

## ğŸ”— ê³„ì¸µ ê°„ ì˜ì¡´ì„± ê·œì¹™

```
Interface â†’ Domain â†’ Adapters
    â†˜        â†“        â†—
       Common/Settings
```

### í•µì‹¬ ê·œì¹™

1. **Interface â†’ Domain**: RouterëŠ” Serviceë§Œ í˜¸ì¶œ
2. **Domain â†’ Adapters**: ServiceëŠ” Repository/Client ì‚¬ìš©
3. **Adapters â†” Settings**: ì™¸ë¶€ ì—°ë™ì€ Settingsì—ì„œ ì„¤ì • ì½ê¸°
4. **Common**: ëª¨ë“  ê³„ì¸µì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìœ í‹¸ë¦¬í‹°

### ê¸ˆì§€ ì‚¬í•­
- âŒ Interfaceì—ì„œ Repository ì§ì ‘ í˜¸ì¶œ
- âŒ Adaptersì—ì„œ Domain ë¡œì§ êµ¬í˜„
- âŒ ìˆœí™˜ ì˜ì¡´ì„± (A â†’ B â†’ A)

---

## ğŸ¯ ê³„ì¸µë³„ ì±…ì„

| ê³„ì¸µ | ìœ„ì¹˜ | ì±…ì„ |
|------|------|------|
| **Interface** | `application/interface/` | HTTP ìš”ì²­/ì‘ë‹µ, ë¼ìš°íŒ…, ì¸ì¦ |
| **Domain** | `application/domain/` | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, íŠ¸ëœì­ì…˜, ìœ íš¨ì„± ê²€ì¦ |
| **Common** | `application/common/` | ê³µí†µ DTO, ë°ì½”ë ˆì´í„°, ì˜ì¡´ì„± ì£¼ì… |
| **Adapters** | `adapters/` | DB, ìºì‹œ, ì™¸ë¶€ API ì—°ë™ |
| **Settings** | `settings/` | í™˜ê²½ ì„¤ì •, ìƒìˆ˜ ê´€ë¦¬ |

---

## ğŸ“š ë„ë©”ì¸ ëª©ë¡

| ë„ë©”ì¸ | ìœ„ì¹˜ | ìƒíƒœ | ì„¤ëª… |
|--------|------|------|------|
| **Auth** | `domain/auth/` | âœ… êµ¬í˜„ë¨ | í† í° ë°œê¸‰/ê°±ì‹  |
| **MarketData** | `domain/market_data/` | âœ… êµ¬í˜„ë¨ | ì‹œì„¸ ì¡°íšŒ, ì°¨íŠ¸ ë°ì´í„° |
| **Account** | `domain/account/` | âœ… êµ¬í˜„ë¨ | ê³„ì¢Œ ì”ê³ , í¬ì§€ì…˜ |
| **Order** | `domain/order/` | âœ… êµ¬í˜„ë¨ | ì£¼ë¬¸ ìƒì„±/ì¡°íšŒ/ì·¨ì†Œ |
| **Strategy** | `domain/strategy/` | âœ… êµ¬í˜„ë¨ | ì „ëµ ê´€ë¦¬ |
| **Backtest** | `domain/backtest/` | âœ… êµ¬í˜„ë¨ | ë°±í…ŒìŠ¤íŒ… ì‹¤í–‰ |
| **WebSocket** | `domain/websocket_domain/` | ğŸš§ ì¤€ë¹„ ì¤‘ | ì‹¤ì‹œê°„ ì‹œì„¸ |

---

## ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œ

### ìƒˆ ë„ë©”ì¸ ì¶”ê°€ ì‹œ
1. `application/domain/{domain_name}/` ìƒì„±
2. `dto.py`: Pydantic DTO ì •ì˜
3. `service.py`: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
4. `application/interface/{domain_name}_router.py` ìƒì„±
5. `main.py`ì— Router ë“±ë¡

### ìƒˆ ì–´ëŒ‘í„° ì¶”ê°€ ì‹œ
1. `adapters/{adapter_type}/` ìƒì„±
2. Client/Repository í´ë˜ìŠ¤ êµ¬í˜„
3. `application/common/dependencies.py`ì— ì˜ì¡´ì„± ë“±ë¡

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [ì•„í‚¤í…ì²˜ ìƒì„¸](../docs/base/ARCHITECTURE.md)
- [ì„œë¹„ìŠ¤ êµ¬í˜„ ê°€ì´ë“œ](../docs/base/SERVICE.md)
- [ì½”ë”© ì»¨ë²¤ì…˜](../docs/base/convention.md)

---

**ğŸ’¡ í•µì‹¬**: ëª¨ë“  ì½”ë“œëŠ” **ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP)**ì„ ì¤€ìˆ˜í•˜ë©°, ê° ê³„ì¸µì€ ìì‹ ì˜ ì—­í• ì—ë§Œ ì§‘ì¤‘í•©ë‹ˆë‹¤.
